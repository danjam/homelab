---
# Beszel Hub - Deploy monitoring hub

- name: Create beszel directory
  ansible.builtin.file:
    path: "{{ beszel_base_dir }}/beszel"
    state: directory
    mode: '0755'

- name: Create beszel data directory
  ansible.builtin.file:
    path: "{{ beszel_data_dir }}"
    state: directory
    mode: '0755'

- name: Ensure homelab network exists
  community.docker.docker_network:
    name: "{{ beszel_network }}"
    state: present

- name: Template docker-compose.yml
  ansible.builtin.template:
    src: docker-compose.yml.j2
    dest: "{{ beszel_base_dir }}/beszel/docker-compose.yml"
    mode: '0644'
  notify: Restart beszel

- name: Start beszel hub
  community.docker.docker_compose_v2:
    project_src: "{{ beszel_base_dir }}/beszel"
    state: present
