#!/bin/bash
#
# Update Ubuntu System Script
# Generated by Ansible - DO NOT EDIT MANUALLY
# Machine: {{ hostname }}
# Domain: {{ domain }}
#

set -e

echo "=================================="
echo "Ubuntu System Update - {{ hostname }}"
echo "=================================="
echo ""

# Check if running as root
if [ "$EUID" -ne 0 ]; then 
    echo "âŒ This script must be run as root (use sudo)"
    exit 1
fi

# Update package lists
echo "ðŸ“¦ Updating package lists..."
if apt update; then
    echo "   âœ… Package lists updated"
else
    echo "   âŒ Failed to update package lists"
    exit 1
fi

echo ""

# Upgrade packages
echo "â¬†ï¸  Upgrading packages..."
if apt upgrade -y; then
    echo "   âœ… Packages upgraded"
else
    echo "   âŒ Failed to upgrade packages"
    exit 1
fi

echo ""

# Distribution upgrade
echo "ðŸ”„ Performing distribution upgrade..."
if apt dist-upgrade -y; then
    echo "   âœ… Distribution upgrade complete"
else
    echo "   âŒ Failed to perform distribution upgrade"
    exit 1
fi

echo ""

# Clean up
echo "ðŸ§¹ Cleaning up..."
apt autoremove -y > /dev/null 2>&1
apt autoclean -y > /dev/null 2>&1
echo "   âœ… Cleanup complete"

echo ""

# Check if reboot is required
if [ -f /var/run/reboot-required ]; then
    echo "âš ï¸  System reboot required!"
    echo ""
    echo "Reboot required by:"
    cat /var/run/reboot-required.pkgs 2>/dev/null || echo "   (package list not available)"
    echo ""
    echo "Run 'sudo reboot' to restart the system."
else
    echo "âœ… No reboot required"
fi

echo ""
echo "=================================="
echo "âœ… System Update Complete!"
echo "=================================="
