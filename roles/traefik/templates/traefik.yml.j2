---
# Traefik static configuration
# Generated by Ansible - do not edit manually

api:
  dashboard: {{ traefik_dashboard_enabled | lower }}
  insecure: {{ traefik_api_insecure | lower }}
  debug: {{ traefik_api_debug | lower }}

entryPoints:
  websecure:
    address: ":443"
    http:
      tls:
        certResolver: {{ traefik_cert_resolver }}
        domains:
          - main: {{ domain_root }}
            sans:
{% for machine in groups['homelab'] %}
              - '*.{{ hostvars[machine].subdomain }}.{{ domain_root }}'
{% endfor %}
              - '*.{{ domain_root }}'

serversTransport:
  insecureSkipVerify: true

providers:
  docker:
    endpoint: "{{ docker_socket_proxy_endpoint }}"
    exposedByDefault: false
  file:
    filename: /dynamic.yaml
    watch: true

certificatesResolvers:
  {{ traefik_cert_resolver }}:
    acme:
      email: {{ vault_cloudflare_email }}
      storage: /certs/acme.json
      caServer: {{ traefik_acme_server }}
      dnsChallenge:
        provider: cloudflare
        resolvers:
          - '1.1.1.1:53'
          - '1.0.0.1:53'

log:
  level: {{ traefik_log_level }}
  filePath: '/logs/traefik.log'

# Uncomment to enable access logs
# accessLog:
#   filePath: '/logs/access.log'
